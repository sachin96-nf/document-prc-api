<?xml version="1.0" encoding="UTF-8"?>

<mule
	xmlns:idp-idp-curative-emailbody-dev-190="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-190"
	xmlns:idp-idp-curative-emailbody-dev-180="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-180"
	xmlns:idp-idp-curative-pdf-dev-140="http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-140"
	xmlns:idp-idp-curative-pdf-dev-130="http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-130"
	xmlns:idp-idp-curative-emailbody-dev-160="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-160"
	xmlns:idp-idp-curative-emailbody-dev-150="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-150"
	xmlns:idp-idp-curative-emailbody-dev-140="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-140"
	xmlns:idp-idp-curative-pdf-dev-120="http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-120"
	xmlns:idp-idp-curative-emailbody-dev-130="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-130" xmlns:idp-idp-curative-pdf-dev-110="http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-110" xmlns:idp-idp-curative-emailbody-dev-120="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-120" xmlns:idp-idp-curative-pdf-dev-100="http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-100" xmlns:idp-idp-curative-emailbody-dev-100="http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-100" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-100 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-100/current/mule-idp-idp-curative-emailbody-dev-100.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-100 http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-100/current/mule-idp-idp-curative-pdf-dev-100.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-120 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-120/current/mule-idp-idp-curative-emailbody-dev-120.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-110 http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-110/current/mule-idp-idp-curative-pdf-dev-110.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-130 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-130/current/mule-idp-idp-curative-emailbody-dev-130.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-120 http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-120/current/mule-idp-idp-curative-pdf-dev-120.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-140 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-140/current/mule-idp-idp-curative-emailbody-dev-140.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-150 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-150/current/mule-idp-idp-curative-emailbody-dev-150.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-160 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-160/current/mule-idp-idp-curative-emailbody-dev-160.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-130 http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-130/current/mule-idp-idp-curative-pdf-dev-130.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-140 http://www.mulesoft.org/schema/mule/idp-idp-curative-pdf-dev-140/current/mule-idp-idp-curative-pdf-dev-140.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-180 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-180/current/mule-idp-idp-curative-emailbody-dev-180.xsd
http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-190 http://www.mulesoft.org/schema/mule/idp-idp-curative-emailbody-dev-190/current/mule-idp-idp-curative-emailbody-dev-190.xsd">
	<sub-flow name="idp-post-emailbody-subflow"
		doc:id="febb0716-ca6f-4d46-bd03-cddefc1065ff">
		<logger level="INFO" doc:name="Info Log"
			doc:id="5c5b0dee-e7c8-45e4-9f64-4eddde1a8ddf"
			message="Start posting pdf file into IDP" />
		<try doc:name="Try" doc:id="b7949688-aa65-4517-8c05-107c9a01a87a" >
			<until-successful maxRetries="${retry.count}" doc:name="Until Successful" doc:id="fa46ff39-c58f-490a-82b4-ddf72b8feae3" millisBetweenRetries="${retry.freq}">
				<choice doc:name="Check IF production" doc:id="65adcc18-4a81-4701-8edd-337160ed9b70" >
					<when expression="#[Mule::p('mule.env') == 'production']">
						<logger level="INFO" doc:name="Logger" doc:id="1835e6e5-8194-46ee-adc8-e54f1bca764e" message="Production"/>
					</when>
					<otherwise >
						<idp-idp-curative-emailbody-dev-190:postdocumentactionexecution doc:name="postDocumentActionExecution" doc:id="192f7de3-d66b-45fd-bb53-c6c2ed14c3e9" config-ref="IDP___idp_curative_emailbody_dev___1_9_0_Config" />
					</otherwise>
				</choice>
		</until-successful>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="626c2979-9a38-4b04-8c1e-15f83d5283e3" >
					<logger level="ERROR" doc:name="Log Error" doc:id="f0cb97cf-3f5f-4e8f-9f0b-075eafe12e95" message="IDP Post failed due to connectivity/Unsufficient-license issues" />
				</on-error-propagate>
			</error-handler>
		</try>
		<logger level="INFO" doc:name="Exit Log"
			doc:id="352e75d7-e845-4667-9e81-2dcdcecb6e37"
			message="File posted to IDP successfully" />
	</sub-flow>
	<sub-flow name="idp-get-emailbody-subflow"
		doc:id="15025b18-ec30-4825-b4fa-7a1f797d94c7">
		<logger level="INFO" doc:name="Info Log"
			doc:id="37e8ced3-2975-4c01-858f-5f497254f67c"
			message="Start getting prompts response from IDP" />
		<ee:transform doc:name="sleep"
			doc:id="fd9efdf7-4e1f-4c3a-bad4-5ff4febad658">
			<ee:message />
			<ee:variables>
				<ee:set-variable resource="dataweave/vSleep.dwl" variableName="sleep" />
			</ee:variables>
		</ee:transform>
		<try doc:name="Try" doc:id="63598100-0b1c-4178-9ed5-8a80dba7b628" >
			<until-successful maxRetries="${retry.count}" doc:name="Until Successful" doc:id="1323a1b5-46e5-43ea-8b23-7af5ecfd07c0" millisBetweenRetries="${retry.freq}">
				<choice doc:name="Check IF production" doc:id="5ce8f9f2-f0fb-41f5-977b-7f3821c6c37b" >
					<when expression="#[Mule::p('mule.env') == 'production']" >
						<logger level="INFO" doc:name="Logger" doc:id="60257ffe-d047-4df3-a887-a81e32c76a0b" message="Production" />
					</when>
					<otherwise>
						<idp-idp-curative-emailbody-dev-190:getdocumentactionexecution doc:name="getDocumentActionExecution" doc:id="afbdd824-6333-403f-b688-af4575074215" execution-id="#[payload.id]" config-ref="IDP___idp_curative_emailbody_dev___1_9_0_Config" />
					</otherwise>
				</choice>
		</until-successful>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="816efcc5-567d-4dc9-b1fd-7ce68e0c433e" >
					<logger level="ERROR" doc:name="Log Error" doc:id="371e1177-70ad-47b0-90b2-0aa764b11316" message="IDP Get failed due to connectivity/Unsufficient-license issues" />
				</on-error-propagate>
			</error-handler>
		</try>
		<choice doc:name="Check if IDP returns prompt values"
			doc:id="38c0eb5c-7964-4d0c-b4a9-7f97f219e245">
			<when
				expression="#[output application/java --- ((payload.status default &quot;&quot;) == &quot;IN_PROGRESS&quot;) and (vars.count_idp &lt; Mule::p('sleep.retry_count'))]">
				<logger level="INFO" doc:name="Info Log"
					doc:id="601dd6b8-8e26-4cdb-833e-3171d9fbfd04"
					message="Didnot get response from IDP. Retrying..." />
				<set-variable value="#[(vars.count_idp default 0) + 1]"
					doc:name="count_idp" doc:id="1b21219f-42aa-42ce-90fb-9129db848eb4"
					variableName="count_idp" />
				<flow-ref doc:name="idp-get-emailbody-subflow"
					doc:id="3eaedf25-ec02-4a39-9d38-c9767eb14e52"
					name="idp-get-emailbody-subflow" />
			</when>
			<otherwise>
				<set-variable value="#[0]" doc:name="count_idp"
					doc:id="fe0c2a62-97c7-499f-afb5-3c2fda3b4376"
					variableName="count_idp" />
			</otherwise>
		</choice>
		<logger level="INFO" doc:name="Exit Log"
			doc:id="67bc476a-a675-4a9f-9986-aeaf26a265f6"
			message="Response received from IDP successfully" />
	</sub-flow>
	<sub-flow name="idp-post-attachment-subflow"
		doc:id="adcc91a0-c418-40a4-97c5-920f315c7e27">
		<logger level="INFO" doc:name="Info Log"
			doc:id="3266af49-cc1b-4350-9648-50c6aa65fa5a"
			message="Start posting pdf file into IDP" />
		<try doc:name="Try" doc:id="f7f6f835-ecdb-46a7-a53a-281c9fcf7fa2" >
			<until-successful maxRetries="${retry.count}" doc:name="Until Successful" doc:id="f3211829-7f05-4971-943e-95a188284bbd" millisBetweenRetries="${retry.freq}">
				<choice doc:name="Check IF production" doc:id="35afbf0e-387d-4d90-90f7-0d316feec733" >
					<when expression="#[Mule::p('mule.env') == 'production']" >
						<logger level="INFO" doc:name="Logger" doc:id="27192e98-d29b-451d-a905-6462c8c384c0" message="Production" />
					</when>
					<otherwise>
						<idp-idp-curative-pdf-dev-140:postdocumentactionexecution doc:name="postDocumentActionExecution" doc:id="f493e260-fc2c-4ddd-ac01-ede254d850a3" config-ref="IDP___idp_curative_pdf_dev___1_4_0_Config" />
					</otherwise>
				</choice>
		</until-successful>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="2e519440-f655-4b5e-af53-535d6c628f4d" >
					<logger level="ERROR" doc:name="Log Error" doc:id="9dadcaf8-2d66-42a5-885f-f1e4b6b44b6b" message="IDP Post failed due to connectivity/Unsufficient-license issues" />
				</on-error-propagate>
			</error-handler>
		</try>
		<logger level="INFO" doc:name="Exit Log"
			doc:id="cbfafdca-50b9-4466-bc74-e771f0b79140"
			message="File posted to IDP successfully" />
	</sub-flow>
	<sub-flow name="idp-get-attachment-subflow"
		doc:id="56497a54-8dc3-4ca2-844a-df8d33626027">
		<logger level="INFO" doc:name="Info Log"
			doc:id="353f4bd0-2523-4865-9fdb-9d8d33b46b2c"
			message="Start getting prompts response from IDP" />
		<ee:transform doc:name="sleep"
			doc:id="a6b53b78-3483-4a0a-9d71-7d7e174e6b0b">
			<ee:message />
			<ee:variables>
				<ee:set-variable resource="dataweave/vSleep.dwl"
					variableName="sleep" />
			</ee:variables>
		</ee:transform>
		<try doc:name="Try" doc:id="c2b0e8a3-f071-4cbb-8288-0ef1d8077217" >
			<until-successful maxRetries="${retry.count}" doc:name="Until Successful" doc:id="a2f6faf4-97ee-4657-8fc9-060c26c531a3" millisBetweenRetries="${retry.freq}">
				<choice doc:name="Check IF production" doc:id="dab528f3-002d-4363-b934-761a2f754ac4" >
					<when expression="#[Mule::p('mule.env') == 'production']" >
						<logger level="INFO" doc:name="Logger" doc:id="f0734138-b46f-48ec-b260-3434cb171569" message="Production" />
					</when>
					<otherwise>
						<idp-idp-curative-pdf-dev-140:getdocumentactionexecution doc:name="getDocumentActionExecution" doc:id="3ca4e3d0-d255-4d15-a78e-f88ea339c983" config-ref="IDP___idp_curative_pdf_dev___1_4_0_Config" execution-id="#[payload.id]" />
					</otherwise>
				</choice>
		</until-successful>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="7d794518-84a7-4e95-a244-1836db252448" >
					<logger level="ERROR" doc:name="Log Error" doc:id="b4cee52d-0cd8-49d2-b4ed-3bb233949e92" message="IDP Get failed due to connectivity/Unsufficient-license issues" />
				</on-error-propagate>
			</error-handler>
		</try>
		<choice doc:name="Check if IDP returns prompt values"
			doc:id="e7557ca8-b7a0-48d3-bf03-ccd19cd27c26">
			<when
				expression="#[output application/java --- ((payload.status default &quot;&quot;) == &quot;IN_PROGRESS&quot;) and (vars.count_idp &lt; Mule::p('sleep.retry_count'))]">
				<logger level="INFO" doc:name="Info Log"
					doc:id="f1a9f692-8ca4-4ccd-9382-7ef3288160af"
					message="Didnot get response from IDP. Retrying..." />
				<set-variable value="#[(vars.count_idp default 0) + 1]"
					doc:name="count_idp" doc:id="4eec316a-f990-4ab2-b51f-cb4d29c2409f"
					variableName="count_idp" />
				<flow-ref doc:name="idp-get-attachment-subflow"
					doc:id="289082c4-b3d1-4e5b-9510-41ade4b309e5"
					name="idp-get-attachment-subflow" />
			</when>
			<otherwise>
				<set-variable value="#[0]" doc:name="count_idp"
					doc:id="9f660214-d412-4e2c-9112-6fe07a468497"
					variableName="count_idp" />
			</otherwise>
		</choice>
		<logger level="INFO" doc:name="Exit Log"
			doc:id="2340a492-ef6a-43c2-af1d-1a79d6970bbd"
			message="Response received from IDP successfully" />
	</sub-flow>
</mule>
